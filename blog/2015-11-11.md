---
Title:  Text to Records, Part III
Author: Shaun Osborne
PostDate:   2015-11-11
AbstractWordCount: 41

...



In [part 2](/blog/2015-11-08/) we talked about the first phase of converting text data into JSON -  a preprocessing step creating 'tagged data'.

In this part I'll try and cover some of the more interesting parts of the *data processing step*. The pre and data processors are both [javascript](https://en.wikipedia.org/wiki/JavaScript) and run on [node.js](https://nodejs.org/en/)

The data processing step (which is a slight misnomer as you will come to see) has one purpose - to convert 'tagged' data into a [JSON](http://json.org/) document containing a structure (mostly nesting and arrays) which accurately reflects the meaning of the pre-processed input. Just a reminder, we can forgot about the unprocessed data here - the only comparison for testing is whether the JSON faithfully represents the tagged data.

To take that idea logically further though, if it doesn't match (i.e. the JSON output here doesn't properly represent the *unprocessed* data) then the problem is almost certainly in the *pre-processor* code/step.

The last thing to say before looking into the pre-processed and JSON records, in the expandable boxes below, is that there will be a *remap processor* after this step.

This, again as described in the previous parts ([I](/blog/2015-08-28/) and [II](/blog/2015-11-08/)), was a simple decision about separation of concerns. Remember our ultimate target here is an indexer containing a schema and data created *for the UI developers* - getting bogged down in that detail at this stage would make the code way too complex, as well as not allowing us to have separate processors (at remap stage) for different parts of the collection should we need them.

<div class = "panel-group" id = "accordion">
   <div class = "panel panel-default">
      <div class = "panel-heading">
               <h4 class = "panel-title">
                  <a data-toggle = "collapse" data-parent = "#accordion" href = "#collapseOne">
                  PRE-processed text record sample (click to expand/collapse)
                  </a>
               </h4>
          </div>
          <div id = "collapseOne" class = "panel-collapse collapse">
         <div class = "panel-body">
            <h5>This is a single PRE processed record created by the preprocessor
            code. I call it 'tagged data' for want of a better term.</h5>
            <p>You will need to scroll sideways in some areas as some output gets quite long</p>
            <p style="overflow: auto; white-space: pre;">
            [new record]
            [new top field] § Identification numbers :
            [new field] Object number : Test-DDF-OPAC-#1
            [new sub field] Other number :
            [new bracket value] † Old ref : 123456‡
            [new bracket value] † Field No. : DP-01-01-14‡
            [new bracket value] † Object Entry No. : 7891011‡
            [new bracket value] † Ms. Cat. 1878 No.:  DP-01-07-14 #1‡
            [new bracket value] † Old ref: Debra Rxyzn DP-01-07-15 #2‡
            [new top field] § Department :
            [new field] Department : Unaccessioned Object (Palaeo)
            [new top field] § Identification type :
            [new bracket value] † Identification type : Identification 05 ¢ Simple name :  ¢ Artefact : archival: book: facsimile~ archival: book ~ Archival ~ ../..‡
            [new bracket value] † Identification type : Identification 04 ¢ Scientific name : Asteracanthus ornatissimus var. flettonensis ¢ Author : Woodward A.S. ¢ Taxonomy : ../.. ~ Chordata : Phylum ~ Vertebrata, Lamarck, 1794 : SubPhylum ~ Pisces, Linnaeus, 1758 : SuperClass ~ Elasmobranchii : Class ~ Hybodontiformes : Order ~ Hybodontidae : Family ~ Asteracanthus : Genus ~ Asteracanthus ornatissimus, Agassiz : Species ~ Asteracanthus ornatissimus var. flettonensis : SubSpecies ¢ Taxonomy type : Fish ¢ Specimen status :  ¢ ../.. ~ TYPE STATUS ~ PRIMARY TYPES ~ paralectotype ¢ ../.. ~ PUBLICATION STATUS ~ fig'd ¢ ../.. ~ PUBLICATION STATUS ~ described ¢ Simple name :  ¢ Taxonomic Hierarchy : Fish~ Vertebrate ~ Chordate ~ Metazoan ~ < ANIMAL > ~ ../.. ¢ Anatomic Details : tooth~ Cephalic skeleton ~ Vertebrate ~ ../.. ¢ Developmental stage : adult~ Vertebrata ~ ../.. ¢ Woodwardian Colln [DP] : pesce vacca~ ../.. ~  ¢ Bibliographic reference :  ¢ Search key : Abbott, D. (1962) ¢ Description : The Gabbro Cumulates of the Kap Edvard Holm complex, East Greenland ¢ Ph.D. thesis (Manchester) ¢ Search key : Abbott, D. & Deer, W.A. (1972) ¢ Description : The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series ¢ Meddelelser om Gronland ¢ Vol: 190, number 6 ¢ Search key : Allen, C.R. (1975) ¢ Description : The Petrology of a portion of the Troodos Plutonic Complex, Cyprus ¢ Ph.D. thesis ¢ Notes : This notes field applies to Instance 04 of the 'Identification type' field group‡
            [new bracket value] † Identification type : Identification 03 ¢ Scientific name : Arnoglossus aff. laterna ¢ Author : (Walbaum) ¢ Taxonomy : ../.. ~ Osteichthyes : SuperClass ~ Actinopterygii : Class ~ Pleuronectiformes : Order ~ Bothidae : Family ~ Arnoglossus : Genus ~ Arnoglossus laterna : Species ¢ Taxonomy type : Fish ¢ Specimen status :  ¢ ../.. ~ TYPE STATUS ~ PRIMARY TYPES ~ lectotype ¢ Simple name :  ¢ Taxonomic Hierarchy : Fish~ Vertebrate ~ Chordate ~ Metazoan ~ < ANIMAL > ~ ../.. ¢ Anatomic Details : tooth~ Cephalic skeleton ~ Vertebrate ~ ../.. ¢ Bibliographic reference :  ¢ Search key : Abbott, D. & Deer, W.A. (1972) ¢ Description : The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series ¢ Meddelelser om Gronland ¢ Vol: 190, number 6 ¢ Notes : This notes field applies to Instance 03 of the 'Identification type' field group‡
            [new bracket value] † Identification type : Identification 02 ¢ Scientific name : Galeocerdo aduncus ¢ Author : Agassiz ¢ Taxonomy : ../.. ~ Chordata : Phylum ~ Vertebrata, Lamarck, 1794 : SubPhylum ~ Pisces, Linnaeus, 1758 : SuperClass ~ Elasmobranchii : Class ~ Carcharhiniformes : Order ~ Carcharhinidae : Family ~ Galeocerdo : Genus ~ Galeocerdo aduncus : Species ¢ Taxonomy type : Fish ¢ Specimen status :  ¢ ../.. ~ TYPE STATUS ~ PRIMARY TYPES ~ paratype ¢ Simple name :  ¢ Taxonomic Hierarchy : Fish~ Vertebrate ~ Chordate ~ Metazoan ~ < ANIMAL > ~ ../.. ¢ Anatomic Details : tooth~ Cephalic skeleton ~ Vertebrate ~ ../.. ¢ Bibliographic reference :  ¢ Search key : Abbass, H.L. (1973) ¢ Description : Some British Cretaceous gastropods belonging to the families procerithiidae, cerithiidae and cerithiopsidae (cerithiacea). Bulletin of the British Museum (Natural History). Geology. vol. 23 ¢ Notes : This notes field applies to Instance 02 of the 'Identification type' field group‡
            [new bracket value] † Identification type : Identification 01 ¢ Scientific name : Galeocerdo sp. ¢ Taxonomy : ../.. ~ Chordata : Phylum ~ Vertebrata, Lamarck, 1794 : SubPhylum ~ Pisces, Linnaeus, 1758 : SuperClass ~ Elasmobranchii : Class ~ Carcharhiniformes : Order ~ Carcharhinidae : Family ~ Galeocerdo : Genus ¢ Taxonomy type : Fish ¢ Specimen status :  ¢ ../.. ~ TYPE STATUS ~ PRIMARY TYPES ~ holotype ¢ Simple name :  ¢ Taxonomic Hierarchy : Fish~ Vertebrate ~ Chordate ~ Metazoan ~ < ANIMAL > ~ ../.. ¢ Anatomic Details : tooth~ Cephalic skeleton ~ Vertebrate ~ ../.. ¢ Bibliographic reference :  ¢ Search key : Abbass, H.L. (1962) ¢ Description : The English Cretaceous Turritellidae and Mathildidaen (Gastropoda). Bulletin of the British Museum (Natural History). Geology  vol. vii. pp.173-196 ¢ Notes : This notes field applies to Instance 01 of the 'Identification type' field group‡
            [new top field] § Physical description :
            [new sub field] Measurements :
            [new bracket value] † Length : 10 cm‡
            [new bracket value] † Width : 20 cm‡
            [new bracket value] † Thickness : 1 cm‡
            [new field] Notes : This notes field applies to the 'Physical description' field group which is not repeatable
            [new top field] § Comments :
            [new bracket value] † Information type : Transcribed catalogue entry ¢ Transcribed catalogue information can be recorded here and is useful public information‡
            [new bracket value] † Information type : Label ¢ Specimen label information can be recorded here and is useful public information‡
            [new bracket value] † Information type : Translated transcription ¢ Translated transcription information can be recorded here and is useful public information‡
            [new bracket value] † Information type : From Object Entry Form ¢ This information needs to be private‡
            [new top field] § Collection record :
            [new sub field] Locality :
            [new bracket value] † ../.. ~ Europe : Continent ~ Western Europe : Continent ~ United Kingdom~ England‡
            [new bracket value] † ../.. ~ Europe : Continent ~ Western Europe : Continent ~ United Kingdom ~ England : country~ Hertfordshire ¢ Locality coordinates :  ¢ Latitude/Longitude (Standardised) : 24.20S 68.80W‡
            [new bracket value] † ../.. ~ Europe : Continent ~ Western Europe : Continent ~ United Kingdom ~ England : country ~ Hertfordshire : county~ Hitchin‡
            [new bracket value] † ../.. ~ Europe : Continent ~ Western Europe : Continent ~ United Kingdom ~ England : country ~ Hertfordshire : county ~ Hitchin~ Hitchin (gravel pit) ¢ Locality coordinates :  ¢ Latitude/Longitude (Standardised) : 24.20S 68.80W‡
            [new bracket value] † ../.. ~ Africa : Continent ~ Egypt : country~ Abu Swayd (copper mine)‡
            [new sub field] Coordinates :
            [new bracket value] † GB National grid ref (Standardised) : TL1930‡
            [new bracket value] † Latitude/Longitude (Standardised) : 51.9470N 0.2830W‡
            [new bracket value] † Latitude/Longitude (deg. min. sec.) : 51° 56' 49.2"N 0° 16' 58.7994"W‡
            [new sub field] Collector :
            [new bracket value] † Pxyzn, Dan‡
            [new bracket value] † Rxyzy, Matthew‡
            [new sub field] Collection date :
            [new bracket value] † Date collected : 2014‡
            [new bracket value] † Date received : 2014/01/16‡
            [new bracket value] † Deposited : 2014/04/04‡
            [new field] Notes : This notes field applies to the 'Collection Record' field group. The group is not repeatable, but all of its component fields are.
            [new top field] § Geological dating :
            [new bracket value] † Chronostratigraphy : Cretaceous ~ Mesozoic ~ Phanerozoic ~ ../..‡
            [new bracket value] † Chronostratigraphy : Cretaceous (lower) ~ Cretaceous ~ Mesozoic ~ Phanerozoic ~ ../..‡
            [new bracket value] † Chronostratigraphy : Albian ~ Albian-Aptian ~ Gallic ~ Cretaceous ~ Mesozoic ~ Phanerozoic ~ ../..‡
            [new bracket value] † Chronostratigraphy : Albian (? early) ~ Albian ~ Albian-Aptian ~ Gallic ~ Cretaceous ~ Mesozoic ~ Phanerozoic ~ ../..‡
            [new bracket value] † Lithostratigraphy : Gault ~ < Lower Cretaceous - broadly > ~ < Cretaceous - broadly > ~ < Mesozoic - broadly > ~ ../..‡
            [new bracket value] † Lithostratigraphy : Gault (lower) ~ Gault ~ < Lower Cretaceous - broadly > ~ < Cretaceous - broadly > ~ < Mesozoic - broadly > ~ ../..‡
            [new bracket value] † Biostratigraphy : Euhoplites lautus zone ~ < Lower Cretaceous - broadly > ~ < Cretaceous - broadly > ~ < Mesozoic - broadly > ~ ../..‡
            [new field] Notes : This notes field applies to the 'Geological dating' group field
            [newvalue]  The group field is not repeatable but its fields are
            [new top field] § Historical associations :
            [new bracket value] † Association type : gift ¢ Associated person/body : Pxyzn, Dan ¢ Notes : This notes field applies to the above repeatable 'historical associations' field group‡
            [new bracket value] † Association type : purchased ¢ Associated person/body : Rxyzy, Matthew ¢ Notes : This notes field applies to the above repeatable 'historical associations' field group‡
            [new top field] § Bibliography :
            [new bracket value] † Information type : Identification 01 ¢ Search key : Abbass, H.L. (1962) ¢ Description : The English Cretaceous Turritellidae and Mathildidaen (Gastropoda). Bulletin of the British Museum (Natural History). Geology  vol. vii. pp.173-196 ¢ Notes : This notes field applies to the bibliographic reference above and usually contains page & fig info.‡
            [new bracket value] † Information type : Identification 02 ¢ Search key : Abbass, H.L. (1973) ¢ Description : Some British Cretaceous gastropods belonging to the families procerithiidae, cerithiidae and cerithiopsidae (cerithiacea). Bulletin of the British Museum (Natural History). Geology. vol. 23 ¢ Notes : This notes field applies to the bibliographic reference above and usually contains page & fig info.‡
            [new bracket value] † Information type : Identification 03 ¢ Search key : Abbott, D. & Deer, W.A. (1972) ¢ Description : The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series ¢ Meddelelser om Gronland ¢ Vol: 190, number 6 ¢ Notes : This notes field applies to the bibliographic reference above and usually contains page & fig info.‡
            [new bracket value] † Information type : Identification 04 ¢ Search key : Abbott, D. (1962) ¢ Description : The Gabbro Cumulates of the Kap Edvard Holm complex, East Greenland ¢ Ph.D. thesis (Manchester) ¢ Notes : This notes field applies to the bibliographic reference above and usually contains page & fig info.‡
            [new bracket value] † Information type : Identification 04 ¢ Search key : Abbott, D. & Deer, W.A. (1972) ¢ Description : The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series ¢ Meddelelser om Gronland ¢ Vol: 190, number 6 ¢ Notes : This notes field applies to the bibliographic reference above and usually contains page & fig info.‡
            [new bracket value] † Information type : Identification 04 ¢ Search key : Allen, C.R. (1975) ¢ Description : The Petrology of a portion of the Troodos Plutonic Complex, Cyprus ¢ Ph.D. thesis ¢ Notes : This notes field applies to the bibliographic reference above and usually contains page & fig info.‡
            [new top field] § Photography :
            [new bracket value] † Information type : image ¢ Photography :  ¢ test 100‡
            [new bracket value] † Information type : image ¢ Photography :  ¢ test‡
            [new top field] § Archives :
            [new bracket value] † Information type : Archive Drawing ¢ Shelf mark : SCLA 01/TAB28  ¢ Title : Table 28 (XXVIII) 'La vana speculazione' From original file title‡
            [new bracket value] † Information type : Archive Collection (fonds) ¢ Shelf mark : SCLA  ¢ Title : The Papers of Agostino Scilla (1629-1700) ¢ Notes : This notes field applies to the 'Archives' field group which is repeatable‡
            [new bracket value] † Information type : Archive Specimen Catalogue ¢ Shelf mark : TESTWoodward/1  ¢ Title : AN ATTEMPT Towards a Natural History OF THE FOSSILS of ENGLAND ¢ Notes : This notes field applies to the 'Archives' field group which is repeatable‡
            [new top field] § Associated object :
            [new sub field] Managed object :
            [new bracket value] † Test-DDF-OPAC-#1.1 Asteracanthus ornatissimus var. flettonensis. Fish‡
            [new bracket value] † Test-DDF-OPAC-#1.1 a Asteracanthus ornatissimus var. flettonensis. Fish‡
            [new bracket value] † Test-DDF-OPAC-#1.1 b Asteracanthus ornatissimus var. flettonensis‡
            [new bracket value] † Test-DDF-OPAC-#1.2‡
            [new bracket value] † Test-DDF-OPAC-#1.2.1. Fish‡
            [new bracket value] † Test-DDF-OPAC-#1.2.2‡
            [new top field] § System info :
            [new field] Last update : 1 July 2015
            [new field] System number :  253643
            [new field] Record status : Validated record
            </p>
         </div>
      </div>
  </div>
</div>



<div class = "panel-group" id = "accordion">
   <div class = "panel panel-default">
      <div class = "panel-heading">
               <h4 class = "panel-title">
                  <a data-toggle = "collapse" data-parent = "#accordion" href = "#collapseTwo">
                  JSON record sample (click to expand/collapse)
                  </a>
               </h4>
          </div>
          <div id = "collapseTwo" class = "panel-collapse collapse">
         <div class = "panel-body" >
         <h5>This is the single JSON record after DATA processing.<br/></h5>
         <p>You will need to scroll sideways in some areas as some output gets quite long</p>
            <p style="overflow: auto; white-space: pre;">
            {
      "records": [
          {
              "identificationNumbers": {
                  "objectNumber": "Test-DDF-OPAC-#1",
                  "otherNumber": {
                      "oldRef": "Debra Rxyzn DP-01-07-15 #2",
                      "fieldNo": "DP-01-01-14",
                      "objectEntryNo": "7891011",
                      "msCat1878No": "DP-01-07-14 #1"
                  }
              },
              "department": {
                  "department": "Unaccessioned Object (Palaeo)"
              },
              "identificationType": {
                  "-subfield": [
                      {
                          "identificationType": "Identification 05",
                          "artefact": "archival: book: facsimile~ archival: book ~ Archival ~ ../.."
                      },
                      {
                          "identificationType": "Identification 04",
                          "scientificName": "Asteracanthus ornatissimus var. flettonensis",
                          "": [
                              "Author : Woodward A.S."
                          ],
                          "taxonomy": "../.. ~ Chordata : Phylum ~ Vertebrata, Lamarck, 1794 : SubPhylum ~ Pisces, Linnaeus, 1758 : SuperClass ~ Elasmobranchii : Class ~ Hybodontiformes : Order ~ Hybodontidae : Family ~ Asteracanthus : Genus ~ Asteracanthus ornatissimus, Agassiz : Species ~ Asteracanthus ornatissimus var. flettonensis : SubSpecies",
                          "taxonomyType": "Fish",
                          "specimenStatus": [
                              "../.. ~ TYPE STATUS ~ PRIMARY TYPES ~ paralectotype",
                              "../.. ~ PUBLICATION STATUS ~ fig'd",
                              "../.. ~ PUBLICATION STATUS ~ described"
                          ],
                          "taxonomicHierarchy": "Fish~ Vertebrate ~ Chordate ~ Metazoan ~ < ANIMAL > ~ ../..",
                          "anatomicDetails": "tooth~ Cephalic skeleton ~ Vertebrate ~ ../..",
                          "developmentalStage": "adult~ Vertebrata ~ ../..",
                          "woodwardianColln [dp]": "pesce vacca~ ../.. ~",
                          "searchKey": [
                              [
                                  "Abbott, D. (1962)",
                                  "Abbott, D. & Deer, W.A. (1972)"
                              ],
                              "Allen, C.R. (1975)"
                          ],
                          "bibliographicReference": [
                              "Description : The Gabbro Cumulates of the Kap Edvard Holm complex, East Greenland",
                              "Ph.D. thesis (Manchester)",
                              "Description : The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series",
                              "Meddelelser om Gronland",
                              "Vol: 190, number 6",
                              "Description : The Petrology of a portion of the Troodos Plutonic Complex, Cyprus",
                              "Ph.D. thesis"
                          ],
                          "notes": "This notes field applies to Instance 04 of the 'Identification type' field group"
                      },
                      {
                          "identificationType": "Identification 03",
                          "scientificName": "Arnoglossus aff. laterna",
                          "": [
                              "Author : (Walbaum)"
                          ],
                          "taxonomy": "../.. ~ Osteichthyes : SuperClass ~ Actinopterygii : Class ~ Pleuronectiformes : Order ~ Bothidae : Family ~ Arnoglossus : Genus ~ Arnoglossus laterna : Species",
                          "taxonomyType": "Fish",
                          "specimenStatus": [
                              "../.. ~ TYPE STATUS ~ PRIMARY TYPES ~ lectotype"
                          ],
                          "taxonomicHierarchy": "Fish~ Vertebrate ~ Chordate ~ Metazoan ~ < ANIMAL > ~ ../..",
                          "anatomicDetails": "tooth~ Cephalic skeleton ~ Vertebrate ~ ../..",
                          "searchKey": "Abbott, D. & Deer, W.A. (1972)",
                          "bibliographicReference": [
                              "Description : The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series",
                              "Meddelelser om Gronland",
                              "Vol: 190, number 6"
                          ],
                          "notes": "This notes field applies to Instance 03 of the 'Identification type' field group"
                      },
                      {
                          "identificationType": "Identification 02",
                          "scientificName": "Galeocerdo aduncus",
                          "": [
                              "Author : Agassiz"
                          ],
                          "taxonomy": "../.. ~ Chordata : Phylum ~ Vertebrata, Lamarck, 1794 : SubPhylum ~ Pisces, Linnaeus, 1758 : SuperClass ~ Elasmobranchii : Class ~ Carcharhiniformes : Order ~ Carcharhinidae : Family ~ Galeocerdo : Genus ~ Galeocerdo aduncus : Species",
                          "taxonomyType": "Fish",
                          "specimenStatus": [
                              "../.. ~ TYPE STATUS ~ PRIMARY TYPES ~ paratype"
                          ],
                          "taxonomicHierarchy": "Fish~ Vertebrate ~ Chordate ~ Metazoan ~ < ANIMAL > ~ ../..",
                          "anatomicDetails": "tooth~ Cephalic skeleton ~ Vertebrate ~ ../..",
                          "searchKey": "Abbass, H.L. (1973)",
                          "bibliographicReference": [
                              "Description : Some British Cretaceous gastropods belonging to the families procerithiidae, cerithiidae and cerithiopsidae (cerithiacea). Bulletin of the British Museum (Natural History). Geology. vol. 23"
                          ],
                          "notes": "This notes field applies to Instance 02 of the 'Identification type' field group"
                      },
                      {
                          "identificationType": "Identification 01",
                          "scientificName": "Galeocerdo sp.",
                          "taxonomy": "../.. ~ Chordata : Phylum ~ Vertebrata, Lamarck, 1794 : SubPhylum ~ Pisces, Linnaeus, 1758 : SuperClass ~ Elasmobranchii : Class ~ Carcharhiniformes : Order ~ Carcharhinidae : Family ~ Galeocerdo : Genus",
                          "taxonomyType": "Fish",
                          "specimenStatus": [
                              "../.. ~ TYPE STATUS ~ PRIMARY TYPES ~ holotype"
                          ],
                          "taxonomicHierarchy": "Fish~ Vertebrate ~ Chordate ~ Metazoan ~ < ANIMAL > ~ ../..",
                          "anatomicDetails": "tooth~ Cephalic skeleton ~ Vertebrate ~ ../..",
                          "searchKey": "Abbass, H.L. (1962)",
                          "bibliographicReference": [
                              "Description : The English Cretaceous Turritellidae and Mathildidaen (Gastropoda). Bulletin of the British Museum (Natural History). Geology  vol. vii. pp.173-196"
                          ],
                          "notes": "This notes field applies to Instance 01 of the 'Identification type' field group"
                      }
                  ]
              },
              "physicalDescription": {
                  "measurements": {
                      "length": "10 cm",
                      "width": "20 cm",
                      "thickness": "1 cm"
                  },
                  "notes": "This notes field applies to the 'Physical description' field group which is not repeatable"
              },
              "comments": {
                  "-subfield": [
                      {
                          "informationType": "Transcribed catalogue entry",
                          "-flushed": [
                              "Transcribed catalogue information can be recorded here and is useful public information"
                          ]
                      },
                      {
                          "informationType": "Label",
                          "-flushed": [
                              "Specimen label information can be recorded here and is useful public information"
                          ]
                      },
                      {
                          "informationType": "Translated transcription",
                          "-flushed": [
                              "Translated transcription information can be recorded here and is useful public information"
                          ]
                      },
                      {
                          "informationType": "From Object Entry Form",
                          "-flushed": [
                              "This information needs to be private"
                          ]
                      }
                  ]
              },
              "collectionRecord": {
                  "locality": {
                      "1": "../.. ~ Europe : Continent ~ Western Europe : Continent ~ United Kingdom~ England",
                      "2": {
                          "0": "../.. ~ Europe : Continent ~ Western Europe : Continent ~ United Kingdom ~ England : country~ Hertfordshire ",
                          "latitude/longitude (standardised)": "24.20S 68.80W"
                      },
                      "3": "../.. ~ Europe : Continent ~ Western Europe : Continent ~ United Kingdom ~ England : country ~ Hertfordshire : county~ Hitchin",
                      "4": {
                          "0": "../.. ~ Europe : Continent ~ Western Europe : Continent ~ United Kingdom ~ England : country ~ Hertfordshire : county ~ Hitchin~ Hitchin (gravel pit) ",
                          "latitude/longitude (standardised)": "24.20S 68.80W"
                      },
                      "5": "../.. ~ Africa : Continent ~ Egypt : country~ Abu Swayd (copper mine)"
                  },
                  "coordinates": {
                      "gbNationalGridRef (standardised)": "TL1930",
                      "latitude/longitude (standardised)": "51.9470N 0.2830W",
                      "latitude/longitude (degMinSec.)": "51° 56' 49.2\"N 0° 16' 58.7994\"W"
                  },
                  "collector": {
                      "1": "Pxyzn, Dan",
                      "2": "Rxyzy, Matthew"
                  },
                  "collectionDate": {
                      "dateCollected": "2014",
                      "dateReceived": "2014/01/16",
                      "deposited": "2014/04/04"
                  },
                  "notes": "This notes field applies to the 'Collection Record' field group. The group is not repeatable, but all of its component fields are."
              },
              "geologicalDating": {
                  "-subfield": [
                      "Chronostratigraphy : Cretaceous ~ Mesozoic ~ Phanerozoic ~ ../..",
                      "Chronostratigraphy : Cretaceous (lower) ~ Cretaceous ~ Mesozoic ~ Phanerozoic ~ ../..",
                      "Chronostratigraphy : Albian ~ Albian-Aptian ~ Gallic ~ Cretaceous ~ Mesozoic ~ Phanerozoic ~ ../..",
                      "Chronostratigraphy : Albian (? early) ~ Albian ~ Albian-Aptian ~ Gallic ~ Cretaceous ~ Mesozoic ~ Phanerozoic ~ ../..",
                      "Lithostratigraphy : Gault ~ < Lower Cretaceous - broadly > ~ < Cretaceous - broadly > ~ < Mesozoic - broadly > ~ ../..",
                      "Lithostratigraphy : Gault (lower) ~ Gault ~ < Lower Cretaceous - broadly > ~ < Cretaceous - broadly > ~ < Mesozoic - broadly > ~ ../..",
                      "Biostratigraphy : Euhoplites lautus zone ~ < Lower Cretaceous - broadly > ~ < Cretaceous - broadly > ~ < Mesozoic - broadly > ~ ../.."
                  ],
                  "notes": "This notes field applies to the 'Geological dating' group field"
              },
              "historicalAssociations": {
                  "-subfield": [
                      {
                          "associationType": "gift",
                          "associatedPerson/body": "Pxyzn, Dan",
                          "notes": "This notes field applies to the above repeatable 'historical associations' field group"
                      },
                      {
                          "associationType": "purchased",
                          "associatedPerson/body": "Rxyzy, Matthew",
                          "notes": "This notes field applies to the above repeatable 'historical associations' field group"
                      }
                  ]
              },
              "bibliography": {
                  "-subfield": [
                      {
                          "informationType": "Identification 01",
                          "searchKey": "Abbass, H.L. (1962)",
                          "description": "The English Cretaceous Turritellidae and Mathildidaen (Gastropoda). Bulletin of the British Museum (Natural History). Geology  vol. vii. pp.173-196",
                          "notes": "This notes field applies to the bibliographic reference above and usually contains page & fig info."
                      },
                      {
                          "informationType": "Identification 02",
                          "searchKey": "Abbass, H.L. (1973)",
                          "description": "Some British Cretaceous gastropods belonging to the families procerithiidae, cerithiidae and cerithiopsidae (cerithiacea). Bulletin of the British Museum (Natural History). Geology. vol. 23",
                          "notes": "This notes field applies to the bibliographic reference above and usually contains page & fig info."
                      },
                      {
                          "informationType": "Identification 03",
                          "searchKey": "Abbott, D. & Deer, W.A. (1972)",
                          "description": "The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series",
                          "-flushed": [
                              "Meddelelser om Gronland"
                          ],
                          "vol": "Vol: 190, number 6",
                          "notes": "This notes field applies to the bibliographic reference above and usually contains page & fig info."
                      },
                      {
                          "informationType": "Identification 04",
                          "searchKey": "Abbott, D. (1962)",
                          "description": "The Gabbro Cumulates of the Kap Edvard Holm complex, East Greenland",
                          "-flushed": [
                              "Ph.D. thesis (Manchester)"
                          ],
                          "notes": "This notes field applies to the bibliographic reference above and usually contains page & fig info."
                      },
                      {
                          "informationType": "Identification 04",
                          "searchKey": "Abbott, D. & Deer, W.A. (1972)",
                          "description": "The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series",
                          "-flushed": [
                              "Meddelelser om Gronland"
                          ],
                          "vol": "Vol: 190, number 6",
                          "notes": "This notes field applies to the bibliographic reference above and usually contains page & fig info."
                      },
                      {
                          "informationType": "Identification 04",
                          "searchKey": "Allen, C.R. (1975)",
                          "description": "The Petrology of a portion of the Troodos Plutonic Complex, Cyprus",
                          "-flushed": [
                              "Ph.D. thesis"
                          ],
                          "notes": "This notes field applies to the bibliographic reference above and usually contains page & fig info."
                      }
                  ]
              },
              "photography": {
                  "-subfield": [
                      {
                          "informationType": "image",
                          "photography": [
                              "test 100"
                          ]
                      },
                      {
                          "informationType": "image",
                          "photography": [
                              "test"
                          ]
                      }
                  ]
              },
              "archives": {
                  "-subfield": [
                      {
                          "informationType": "Archive Drawing",
                          "shelfMark": "SCLA 01/TAB28",
                          "title": "Table 28 (XXVIII) 'La vana speculazione' From original file title"
                      },
                      {
                          "informationType": "Archive Collection (fonds)",
                          "shelfMark": "SCLA",
                          "title": "The Papers of Agostino Scilla (1629-1700)",
                          "notes": "This notes field applies to the 'Archives' field group which is repeatable"
                      },
                      {
                          "informationType": "Archive Specimen Catalogue",
                          "shelfMark": "TESTWoodward/1",
                          "title": "AN ATTEMPT Towards a Natural History OF THE FOSSILS of ENGLAND",
                          "notes": "This notes field applies to the 'Archives' field group which is repeatable"
                      }
                  ]
              },
              "associatedObject": {
                  "managedObject": {
                      "1": "Test-DDF-OPAC-#1.1 Asteracanthus ornatissimus var. flettonensis. Fish",
                      "2": "Test-DDF-OPAC-#1.1 a Asteracanthus ornatissimus var. flettonensis. Fish",
                      "3": "Test-DDF-OPAC-#1.1 b Asteracanthus ornatissimus var. flettonensis",
                      "4": "Test-DDF-OPAC-#1.2",
                      "5": "Test-DDF-OPAC-#1.2.1. Fish",
                      "6": "Test-DDF-OPAC-#1.2.2"
                  }
              },
              "systemInfo": {
                  "lastUpdate": "1 July 2015",
                  "systemNumber": "253643",
                  "recordStatus": "Validated record"
              }
          }
      ]
  }
            </p>
         </div>
      </div>
  </div>
</div>

#### Points of interest

So, the first thing to note is while this is both valid as a JSON object, and as a structural representation of the record, it is most definitely not *pretty* :-) . And remember this is a single record..

There's a variety of sub-structures - arrays, objects etc some which are just numbered, not even fielded yet.

Markers like "-subfield" (to group arrays together), and "-flushed" (to handle 'orphan' strings which usually belong to the group level we're at, but there's nothing explicit to say so in the raw or pre-processed data) are methods of explicitly 'fielding', structurally, what we 'saw' in the pre-proccessed data. Clearly they are not useful as a 'final schema', but as an interim step they try to make clear the interpretation of the pre-processed data.

Fields which 'drop out' properly are pretty much in their final form. Another choice was to standardise field names at this stage using ['camelCase'](https://en.wikipedia.org/wiki/CamelCase) across the board - if you compare pre-processed to JSON it's easy to see.

Other fields are still not 'split out' - e.g. right from the top of the JSON,  "Author : Woodward A.S." is clearly a co-joined field+value still.

Hierarchies are the same - e.g. "artefact": "archival: book: facsimile~ archival: book ~ Archival ~ ../.." where the value is a hierarchy containing specific starters and separators which are not interpreted at this stage. The primary reason to not process Hierarchies until the remap stage is their complexity, or more precisely their variety. This is imposed by the complexity of the data in the source database, as well as the limitation of the reporting tools (to generate the raw data) in the source database. As examples - hierarchies can run forwards, or backwards, values can be typed (fielded) or not, fields:values can be transposed and on, and on... and on :-). So at data processing stage the best we can hope for is to get them in the right place in the structure cleanly.

Another bugbear, imposed by the limitation of reporting tools, is that some groups come out serially 'beside each other' - in the JSON above the first example of that is:
<pre>"searchKey": [
    [
     "Abbott, D. (1962)",
     "Abbott, D. & Deer, W.A. (1972)"
    ],
    "Allen, C.R. (1975)"
],
"bibliographicReference": [
    "Description : The Gabbro Cumulates of the Kap Edvard Holm complex, East Greenland",
    "Ph.D. thesis (Manchester)",
    "Description : The Gabbro Cumulates of the Kap Edvard Holm Lower Layered Series",
    "Meddelelser om Gronland",
    "Vol: 190, number 6",
    "Description : The Petrology of a portion of the Troodos Plutonic Complex, Cyprus",
    "Ph.D. thesis"
],
</pre>  
where the authors and the descriptions belong together but are only related by their order in 'searchKey' and 'bibliographicReference' arrays. This is a direct result of post-relational type systems, and you might see it quite a lot in cultural data from different institutions, coming out of post-relational collections management systems.

Once again, though, this is a structural issue in the source raw data. So it's a better choice to deal with this at 'remap' stage because during data processing we really are just trying to create an accurate representation of what the pre-processed data presents - in this case the data is *damn ugly* :-) but we are leaving *interpretation* (and fixes based on that interpretation) of the data to the remap phase. And, frankly, its much easier to deal with after this initial valid JSON record exists, because we know about these oddities and *precisely* where in the JSON structure they are going to occur (read: it's easier to code for when it's more explicit -  not great, just a bit easier..).

'Notes' fields crop up all over the place, and can exist at almost any level - keeping them in the right place can be a bit of a challenge, but again where oddities arise due to the raw data we pick them up later during remap.

So, as ugly as it all seems :-) ... the data processor is only a couple of hundred of lines of javascript code, and *relatively*, if not entirely, straightforward to understand. Getting the balance between generic and too complex was goal here, and keeping an eye on the end product was the key - we want JSON records which structurally represent the data we're getting, no more, no less. We'll leave the rest to the remap processor.
